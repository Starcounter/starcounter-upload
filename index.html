<!DOCTYPE html>
<html>
<head>
    <title>starcounter-include demo</title>
    <meta charset="utf-8" />
    
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
    <link href="starcounter-upload.html" rel="import" />

    <!-- Loading mock server - needed only for demo -->
    <script src="test/mockServer.js"></script>

    <style>
        body {
            padding: 50px;
        }
    </style>
</head>
<body>
    <template is="dom-bind">
        <fieldset>
            <legend>Files</legend>
            <table class="table table-condensed">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Size</th>
                        <th>Progress</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody>
                    <template is="dom-repeat" items="{{model.files}}">
                        <tr>
                            <td>{{item.file.name}}</td>
                            <td>{{item.sizeString}}</td>
                            <td>{{item.progress}}</td>
                            <td>{{item.error}}</td>
                        </tr>
                    </template>
                </tbody>
            </table>
        </fieldset>
        <hr />
        <div class="starcounter-upload-tasks">
            <h4><code>starcounter-upload.tasks</code> collection</h4>
            <table class="table table-condensed">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Size</th>
                        <th>Progress</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody>
                    <template is="dom-repeat" items="{{tasks}}">
                        <tr>
                            <td>{{item.file.name}}</td>
                            <td>{{item.sizeString}}</td>
                            <td>{{item.progress}}</td>
                            <td>{{item.error}}</td>
                        </tr>
                    </template>
                </tbody>
            </table>
        </div>
        <hr />
        <p>
            <starcounter-upload upload-url="/starcounter-upload" session-id="mock-session" tasks="{{tasks}}" on-statechange="onUploadingStateChange">
                <button type="button" class="btn btn-sm btn-default" on-click="selectFile">Select file</button>
            </starcounter-upload>
        </p>
    </template>
    <script>
        (function () {
            var script = document._currentScript || document.currentScript;
            var template = script.previousElementSibling;
            var model = {
                files: []
            };

            template.selectFile = function () {
                template.parentNode.querySelector("starcounter-upload").selectFile();
            };

            template.onUploadingStateChange = function (e) {
                var task = e.detail;

                if (task.progress >= 100 || task.error) {
                    template.push("model.files", task);
                }
            };

            template.model = model;
        })();
    </script>
</body>
</html>
